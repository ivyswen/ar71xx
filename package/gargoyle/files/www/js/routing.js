function saveChanges(){setControlsEnabled(!1,!0,"Please Wait While Settings Are Applied");var e=[],t=uciOriginal.getAllSectionsOfType("network","route");while(t.length>0){var n=t.pop();uciOriginal.removeSection("network",n),e.push("uci del network."+n)}e.push("uci commit");var r=uciOriginal.clone(),i=document.getElementById("static_route_table_container").firstChild,s=getTableDataArray(i,!0,!1),o=0;for(o=0;o<s.length;o++){var u=s[o],a=parseDest(u[0]),f=a[0],l=a[1],c=u[1],h=u[2]=="*"?"0.0.0.0":u[2],p="route"+(o+1);r.set("network",p,"","route"),r.set("network",p,"target",f),r.set("network",p,"interface",c),r.set("network",p,"gateway",h),l!=""&&r.set("network",p,"netmask",l)}commands=e.join("\n")+"\n"+r.getScriptCommands(uciOriginal)+"\nsh /usr/lib/gargoyle/restart_network.sh ;\n";var d=getParameterDefinition("commands",commands)+"&"+getParameterDefinition("hash",document.cookie.replace(/^.*hash=/,"").replace(/[\t ;]+.*$/,"")),v=function(e){e.readyState==4};runAjax("POST","utility/run_commands.sh",d,v),currentProtocol=location.href.match(/^https:/)?"https":"http",testLocation=currentProtocol+"://"+window.location.host+"/utility/reboot_test.sh",testReboot=function(){toggleReload=!0,setTimeout("testReboot()",5e3),document.getElementById("reboot_test").src=testLocation},setTimeout("testReboot()",15e3),setTimeout("reloadPage()",24e4)}function reloadPage(){if(toggleReload){var e=document.getElementById("reboot_test").readyState;if(typeof e=="undefined"||e==null||e=="complete")toggleReload=!1,document.getElementById("reboot_test").src="",setTimeout("window.location.href = window.location.href;",1500)}}function resetData(){routingData.shift(),routingData.shift();var e=[];while(routingData.length>0){var t=routingData.shift(),n=t.split(/[\t ]+/),r=[],i=n[7];i=n[7]==wanIface?i+" (WAN)":i,i=n[7]==lanIface?i+" (LAN)":i,i!=""&&(c=n[0]=="default"&&n[2]=="0.0.0.0"?"":"/"+n[2],c=c=="/255.255.255.255"?"":c,r.push(n[0]+c,i,n[1],n[4]),e.push(r))}var s=document.getElementById("active_route_table_container");s.firstChild!=null&&s.removeChild(s.firstChild);var o=createTable(["Destination","Interface(Network)","Gateway","Metric"],e,"active_route_table",!1,!1);s.appendChild(o);var u=uciOriginal.getAllSectionsOfType("network","route"),a=[];while(u.length>0){var f=u.shift(),l=uciOriginal.get("network",f,"target"),c=uciOriginal.get("network",f,"netmask"),i=uciOriginal.get("network",f,"interface"),h=uciOriginal.get("network",f,"gateway");h=h=="0.0.0.0"?"*":h,l=c==""?l:l+"/"+c,l=l=="0.0.0.0"||l=="0.0.0.0/0.0.0.0"?"default":l,a.push([l,i,h,createEditButton()])}s=document.getElementById("static_route_table_container"),s.firstChild!=null&&s.removeChild(s.firstChild);var p=createTable(["Destination","Interface","Gateway",""],a,"static_route_table",!0,!1);s.appendChild(p)}function createEditButton(){var e=createInput("button");return e.value="Edit",e.className="default_button",e.onclick=editStaticRoute,e}function addStaticRoute(){errors=proofreadStaticRoute(document);if(errors.length>0)alert(errors.join("\n")+"\n\nCould not add row.");else{var e=parseDest(document.getElementById("add_dest").value),t=e[1]==""?e[0]:e[0]+"/"+e[1],n=getSelectedValue("add_iface"),r=document.getElementById("add_gateway").value;r=r=="0.0.0.0"?"*":r,t=t=="0.0.0.0/0.0.0.0"?"default":t;var i=[t,n,r,createEditButton()],s=document.getElementById("static_route_table_container").firstChild;addTableRow(s,i,!0,!1),document.getElementById("add_dest").value="",document.getElementById("add_gateway").value=""}}function validateGatewayIp(e){return validateIP(e)==0||e=="0.0.0.0"||e=="*"?0:1}function proofreadGatewayIp(e){proofreadText(e,validateGatewayIp,0)}function validateRouteIp(e){return validateIpRange(e)==0||e=="0.0.0.0"||e=="0.0.0.0/0.0.0.0"||e=="0.0.0.0/0"||e=="default"?0:1}function proofreadRouteIp(e){proofreadText(e,validateRouteIp,0)}function proofreadStaticRoute(e){return e=e==null?document:e,addIds=["add_dest","add_gateway"],labelIds=["add_dest_label","add_gateway_label"],functions=[validateRouteIp,validateGatewayIp],returnCodes=[0,0],visibilityIds=addIds,proofreadFields(addIds,labelIds,functions,returnCodes,visibilityIds,e)}function parseDest(e){var t=e;if(t.toLowerCase()=="default"||t=="0.0.0.0"||t=="0.0.0.0/0"||t=="0.0.0.0/0.0.0.0")t="0.0.0.0/0.0.0.0";var n="";if(t.match(/\//)){var r=t.split(/\//);t=r[0],n=r[1];if(!n.match(/\./)){var i=parseInt(n),s=[];while(s.length<4){var o=i>8?8:i,u=255,a=o;while(a<8){var f=7-a;u-=Math.pow(2,f),a++}i-=o,s.push(""+u)}n=s.join(".")}r=t.split(/\./),splitMask=n.split(/\./);var l=3;while(l>0)r[l]=""+(parseInt(r[l])&parseInt(splitMask[l])),l--;t=r.join("."),n=splitMask.join(".")}return[t,n]}function editStaticRoute(){if(typeof editStaticWindow!="undefined")try{editStaticWindow.close()}catch(e){}try{xCoor=window.screenX+225,yCoor=window.screenY+225}catch(e){xCoor=window.left+225,yCoor=window.top+225}editStaticWindow=window.open("static_route_edit.sh","edit","width=560,height=180,left="+xCoor+",top="+yCoor),saveButton=createInput("button",editStaticWindow.document),closeButton=createInput("button",editStaticWindow.document),saveButton.value="Close and Apply Changes",saveButton.className="default_button",closeButton.value="Close and Discard Changes",closeButton.className="default_button",editRow=this.parentNode.parentNode,runOnEditorLoaded=function(){updateDone=!1;if(editStaticWindow.document!=null&&editStaticWindow.document.getElementById("bottom_button_container")!=null){editStaticWindow.document.getElementById("bottom_button_container").appendChild(saveButton),editStaticWindow.document.getElementById("bottom_button_container").appendChild(closeButton);var e=editRow.childNodes[0].firstChild.data,t=editRow.childNodes[2].firstChild.data;t=t=="*"?"0.0.0.0":t,e=e=="default"?"0.0.0.0/0.0.0.0":e,editStaticWindow.document.getElementById("add_dest").value=e,setSelectedValue("add_iface",editRow.childNodes[1].firstChild.data,editStaticWindow.document),editStaticWindow.document.getElementById("add_gateway").value=t,editStaticWindow.document.getElementById("add_button").style.display="none",closeButton.onclick=function(){editStaticWindow.close()},saveButton.onclick=function(){var e=proofreadStaticRoute(editStaticWindow.document,document,editRow);if(e.length>0)alert(e.join("\n")+"\nCould not update static route.");else{var t=editStaticWindow.document.getElementById("add_gateway").value;t=t=="0.0.0.0"?"*":t;var n=parseDest(editStaticWindow.document.getElementById("add_dest").value),r=n[1]==""?n[0]:n[0]+"/"+n[1];r=r=="0.0.0.0/0.0.0.0"?"default":r,editRow.childNodes[0].firstChild.data=r,editRow.childNodes[1].firstChild.data=getSelectedValue("add_iface",editStaticWindow.document),editRow.childNodes[2].firstChild.data=t,editStaticWindow.close()}},editStaticWindow.moveTo(xCoor,yCoor),editStaticWindow.focus(),updateDone=!0}updateDone||setTimeout("runOnEditorLoaded()",250)},runOnEditorLoaded()}var toggleReload=!1;