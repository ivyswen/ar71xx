/*
 * This program is copyright ï¿½ 2008 Eric Bishop and is distributed under the terms of the GNU GPL 
 * version 2.0 with a special clarification/exception that permits adapting the program to 
 * configure proprietary "back end" software provided that all modifications to the web interface
 * itself remain covered by the GPL. 
 * See http://gargoyle-router.com/faq.html#qfoss for more information
 */function saveChanges(){var e=proofreadAll();if(e.length>0)errorString=e.join("\n")+"\n\nChanges could not be applied.",alert(errorString);else{setControlsEnabled(!1,!0),maxConnections=document.getElementById("max_connections").value,tcpTimeout=document.getElementById("tcp_timeout").value,udpTimeout=document.getElementById("udp_timeout").value;var t=[];t.push("cp /etc/sysctl.conf /tmp/sysctl.conf.tmp.1");var n=function(e,n,r){var i=n.replace(/^.*\./g,"");t.push("echo "+r+" > "+e),t.push('cat /tmp/sysctl.conf.tmp.1 | grep -v "^'+n+'=" > /tmp/sysctl.conf.tmp.2'),t.push('echo "'+n+"="+r+'" >> /tmp/sysctl.conf.tmp.2'),t.push("mv /tmp/sysctl.conf.tmp.2 /tmp/sysctl.conf.tmp.1")};n("/proc/sys/net/netfilter/nf_conntrack_max","net.netfilter.nf_conntrack_max",maxConnections),n("/proc/sys/net/netfilter/nf_conntrack_tcp_timeout_established","net.netfilter.nf_conntrack_tcp_timeout_established",tcpTimeout),n("/proc/sys/net/netfilter/nf_conntrack_udp_timeout_stream","net.netfilter.nf_conntrack_udp_timeout_stream",udpTimeout),t.push("mv /tmp/sysctl.conf.tmp.1 /etc/sysctl.conf");var r=getParameterDefinition("commands",t.join("\n"))+"&"+getParameterDefinition("hash",document.cookie.replace(/^.*hash=/,"").replace(/[\t ;]+.*$/,"")),i=function(e){e.readyState==4&&(resetData(),setControlsEnabled(!0))};runAjax("POST","utility/run_commands.sh",r,i)}}function proofreadAll(){var e=function(e){return validateNumericRange(e,1,16384)},t=function(e){return validateNumericRange(e,1,3600)},n=["max_connections","tcp_timeout","udp_timeout"],r=["max_connections_label","tcp_timeout_label","udp_timeout_label"];return proofreadFields(n,r,[e,t,t],[0,0,0],n)}function resetData(){document.getElementById("max_connections").value=maxConnections,document.getElementById("tcp_timeout").value=tcpTimeout,document.getElementById("udp_timeout").value=udpTimeout};